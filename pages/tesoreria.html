<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/png" sizes="16x16" href="../assets/img/Logo TF.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="../assets/img/Logo TF.png" />
    <link rel="icon" type="image/png" sizes="64x64" href="../assets/img/Logo TF.png" />
    <title>Tesorería</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <link rel="stylesheet" href="../styles/styles.css" />
    <link rel="stylesheet" href="../styles/tesoreria.css" />
    <link rel="stylesheet" href="../styles/backend-indicator.css" />

    <!-- Bootstrap JavaScript (requerido para modales) - SIN defer para que cargue inmediatamente -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      // Verificar que Bootstrap se cargó correctamente
      if (typeof bootstrap === 'undefined') {
        console.error('❌ Bootstrap no se cargó correctamente');
      } else {
        console.log('✅ Bootstrap cargado correctamente');
      }
    </script>

    <!-- CRÍTICO: Ocultar elementos del sidebar INMEDIATAMENTE para evitar parpadeo -->
    <style>
      /* Ocultar todos los módulos del sidebar inicialmente (solo dentro del sidebar) */
      .sidebar .nav-item:not(#nav-menu),
      .sidebar-nav .nav-item:not(#nav-menu) {
        display: none !important;
        visibility: hidden !important;
        opacity: 0 !important;
        height: 0 !important;
        overflow: hidden !important;
      }
      /* Permitir que auth.js muestre los elementos con permisos */
      .sidebar .nav-item.permission-granted,
      .sidebar-nav .nav-item.permission-granted {
        display: list-item !important;
        visibility: visible !important;
        opacity: 1 !important;
        height: auto !important;
        overflow: visible !important;
      }
    </style>

    <!-- Performance Optimizations y Loaders Comunes -->
    <script src="../assets/scripts/performance/performance-init.js" defer></script>

    <!-- CRÍTICO: auth.js DEBE cargarse ANTES de common-head-loader.js -->
    <!-- para que los permisos se apliquen antes de que se oculten elementos -->
    <script src="../assets/scripts/auth.js"></script>

    <!-- Ahora cargar common-head-loader.js que esperará a que auth.js esté listo -->
    <script src="../assets/scripts/performance/common-head-loader.js"></script>
    <script src="../assets/scripts/script-loader.js" defer></script>

    <!-- Scripts críticos específicos de la página -->
    <!-- Script crítico: Restaurar estado del sidebar ANTES de renderizar para evitar parpadeo -->
    <script src="../assets/scripts/menu/sidebar-state.js"></script>
    <!-- Script para actualizar período automáticamente -->
    <script src="../assets/scripts/periodo.js"></script>

    <!-- ===== FASE 3: Scripts Base del Sistema (SIN defer) ===== -->
    <!-- CRÍTICO: main.js debe cargarse SIN defer para que funciones base estén disponibles -->
    <script src="../assets/scripts/main.js"></script>
    <!-- CRÍTICO: cache-manager.js debe cargarse ANTES de otros scripts que usan caché -->
    <script src="../assets/scripts/cache-manager.js"></script>
    <!-- CRÍTICO: firebase-init.js debe cargarse PRIMERO para inicializar Firebase -->
    <script type="module" src="../assets/scripts/firebase-init.js"></script>
    <!-- CRÍTICO: firebase-ready.js debe cargarse DESPUÉS de firebase-init.js para verificar disponibilidad -->
    <script src="../assets/scripts/firebase-ready.js"></script>
    <!-- CRÍTICO: firebase-repo-base.js debe cargarse para que FirebaseRepoBase esté disponible -->
    <script src="../assets/scripts/firebase-repo-base.js" defer></script>
    <!-- CRÍTICO: firebase-repos.js debe cargarse DESPUÉS de firebase-repo-base.js para crear los repositorios -->
    <script src="../assets/scripts/firebase-repos.js" defer></script>

    <!-- Sistema de limpieza automática de localStorage -->
    <script src="../assets/scripts/localstorage-cleanup.js" defer></script>
  </head>

  <body>
    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
      <div class="sidebar-header">
        <div class="logo">
          <img src="../assets/img/Logo TF.png" alt="TitanFleet" style="height: 50px; width: auto" />
          <span class="logo-text">TitanFleet</span>
        </div>
        <button class="btn-close-sidebar" id="closeSidebar"><i class="fas fa-times"></i></button>
      </div>
      <nav class="sidebar-nav">
        <ul class="nav-menu">
          <li class="nav-item" id="nav-menu">
            <a href="menu.html" class="nav-link"
              ><i class="fa-solid fa-house-chimney"></i><span>Menú</span></a
            >
          </li>
          <li class="nav-item" id="nav-logistica">
            <a href="logistica.html" class="nav-link"
              ><i class="fas fa-truck"></i><span>Logística</span></a
            >
          </li>
          <li class="nav-item" id="nav-facturacion">
            <a href="facturacion.html" class="nav-link"
              ><i class="fas fa-file-invoice"></i><span>Facturación</span></a
            >
          </li>
          <li class="nav-item" id="nav-trafico">
            <a href="trafico.html" class="nav-link"
              ><i class="fas fa-route"></i><span>Tráfico</span></a
            >
          </li>
          <li class="nav-item" id="nav-operadores">
            <a href="operadores.html" class="nav-link"
              ><i class="fas fa-user"></i><span>Operadores</span></a
            >
          </li>
          <li class="nav-item" id="nav-diesel">
            <a href="diesel.html" class="nav-link"
              ><i class="fa-solid fa-gas-pump"></i><span>Diesel</span></a
            >
          </li>
          <li class="nav-item" id="nav-mantenimiento">
            <a href="mantenimiento.html" class="nav-link"
              ><i class="fa-solid fa-screwdriver-wrench"></i><span>Mantenimiento</span></a
            >
          </li>
          <li class="nav-item active" id="nav-tesoreria">
            <a href="tesoreria.html" class="nav-link"
              ><i class="fa-solid fa-money-bill"></i><span>Tesoreria</span></a
            >
          </li>
          <li class="nav-item" id="nav-cxc">
            <a href="CXC.html" class="nav-link"
              ><i class="fas fa-hand-holding-usd"></i><span>Cuentas x Cobrar</span></a
            >
          </li>
          <li class="nav-item" id="nav-cxp">
            <a href="CXP.html" class="nav-link"
              ><i class="fas fa-credit-card"></i><span>Cuentas x Pagar</span></a
            >
          </li>
          <li class="nav-item" id="nav-inventario">
            <a href="inventario.html" class="nav-link"
              ><i class="fa-solid fa-cart-flatbed"></i><span>Inventario</span></a
            >
          </li>
          <li class="nav-item" id="nav-configuracion">
            <a href="configuracion.html" class="nav-link"
              ><i class="fa-solid fa-gears"></i><span>Configuración</span></a
            >
          </li>
          <li class="nav-item" id="nav-reportes">
            <a href="reportes.html" class="nav-link"
              ><i class="fas fa-chart-line"></i><span>Reportes</span></a
            >
          </li>
        </ul>
      </nav>
    </div>

    <!-- Main Content -->
    <div class="main-content" id="mainContent">
      <!-- Top Bar -->
      <div class="top-bar">
        <button class="btn-toggle-sidebar" id="toggleSidebar">
          <i class="fas fa-bars"></i>
        </button>
        <div class="top-bar-content">
          <div class="page-title-section">
            <h1 class="page-title">
              <i class="fa-solid fa-money-bill"></i>
              Tesoreria
              <span
                id="backendReadyIndicator"
                class="backend-loading-indicator"
                style="display: none"
              >
                <span
                  class="spinner-border spinner-border-sm"
                  role="status"
                  aria-hidden="true"
                ></span>
                <span class="ms-2">Cargando datos...</span>
              </span>
              <span id="backendReadyBadge" class="backend-ready-badge" style="display: none">
                <i class="fas fa-check-circle"></i>
                <span class="ms-2">Listo para trabajar</span>
              </span>
            </h1>
            <div class="current-period">
              <small class="text-muted">Período: </small>
              <span class="period-info" id="currentPeriod">Septiembre 2025</span>
            </div>
          </div>
          <div class="user-info">
            <div class="user-details">
              <i class="fas fa-user-circle"></i>
              <span id="currentUserName">Usuario ERP</span>
            </div>
            <div class="user-actions">
              <button class="btn btn-outline-light btn-sm logout-btn" data-action="logout">
                <i class="fas fa-sign-out-alt"></i> <span class="logout-text">Cerrar Sesión</span>
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Content Area -->
      <div class="content-wrapper" style="padding: 8px">
        <div class="container-fluid">
          <!-- Page Header -->
          <div class="page-header">
            <div class="row align-items-center">
              <div class="col-md-8">
                <h2 class="mb-2">Control de Tesorería</h2>
                <p class="text-muted mb-0">Gestión de movimientos y solicitudes</p>
              </div>
              <div class="col-md-4 text-end">
                <!-- Botones removidos según solicitud -->
              </div>
            </div>
          </div>

          <!-- Tabs Tesorería -->
          <ul class="nav nav-tabs" id="tesoreriaTabs" role="tablist">
            <li class="nav-item" role="presentation">
              <button
                class="nav-link"
                id="estado-cuenta-tab"
                data-bs-toggle="tab"
                data-bs-target="#estado-cuenta"
                type="button"
                role="tab"
              >
                <i class="fas fa-file-invoice-dollar"></i> Estado de Cuenta
              </button>
            </li>
            <li class="nav-item" role="presentation">
              <button
                class="nav-link active"
                id="movimientos-tab"
                data-bs-toggle="tab"
                data-bs-target="#movimientos"
                type="button"
                role="tab"
              >
                <i class="fas fa-exchange-alt"></i> Movimientos
              </button>
            </li>
            <li class="nav-item" role="presentation">
              <button
                class="nav-link"
                id="solicitudes-tab"
                data-bs-toggle="tab"
                data-bs-target="#solicitudes"
                type="button"
                role="tab"
              >
                <i class="fas fa-list"></i> Solicitudes
              </button>
            </li>
          </ul>

          <div class="tab-content" id="tesoreriaTabsContent">
            <!-- Tab Estado de Cuenta -->
            <div class="tab-pane fade" id="estado-cuenta" role="tabpanel">
              <div class="card mb-4">
                <div
                  class="card-header d-flex justify-content-between align-items-center"
                  style="background-color: #2e4154; color: #ffffff"
                >
                  <h4 class="card-title mb-0" style="color: #ffffff">
                    <i class="fas fa-file-invoice-dollar" style="color: #ffffff"></i> Estado de
                    Cuenta Bancario
                  </h4>
                  <div class="d-flex gap-2">
                    <button
                      type="button"
                      class="btn btn-outline-light btn-sm exportar-btn-header"
                      id="btnExportarExcelEstadoCuenta"
                      data-action="exportarEstadoCuentaExcel"
                      disabled
                    >
                      <i class="fas fa-file-excel"></i> Excel
                    </button>
                    <button
                      type="button"
                      class="btn btn-outline-light btn-sm exportar-btn-header"
                      id="btnExportarPDFEstadoCuenta"
                      data-action="exportarEstadoCuentaPDF"
                      disabled
                    >
                      <i class="fas fa-file-pdf"></i> PDF
                    </button>
                  </div>
                </div>
                <div class="card-body">
                  <!-- Filtros -->
                  <div class="filter-section mb-3">
                    <h6 class="mb-3"><i class="fas fa-filter"></i> Filtros</h6>
                    <div class="row g-2">
                      <div class="col-md-3">
                        <label class="form-label">Banco *</label>
                        <select
                          class="form-select"
                          id="filtroBancoEstadoCuenta"
                          required
                          data-action="actualizarCuentasBancariasEstadoCuenta"
                        >
                          <option value="">Seleccione un banco...</option>
                        </select>
                      </div>
                      <div class="col-md-3">
                        <label class="form-label">Cuenta Bancaria *</label>
                        <select class="form-select" id="filtroCuentaEstadoCuenta" required>
                          <option value="">Primero seleccione un banco</option>
                        </select>
                      </div>
                      <div class="col-md-2">
                        <label class="form-label">Fecha Desde</label>
                        <input
                          type="date"
                          class="form-control"
                          id="filtroFechaDesdeEstadoCuenta"
                          data-action="cargarEstadoCuenta"
                        />
                      </div>
                      <div class="col-md-2">
                        <label class="form-label">Fecha Hasta</label>
                        <input
                          type="date"
                          class="form-control"
                          id="filtroFechaHastaEstadoCuenta"
                          data-action="cargarEstadoCuenta"
                        />
                      </div>
                      <div class="col-md-2">
                        <label class="form-label" style="visibility: hidden">&nbsp;</label>
                        <button
                          type="button"
                          class="btn btn-outline-secondary w-100"
                          data-action="limpiarFiltrosEstadoCuenta"
                          style="height: 38px; line-height: 1.5"
                        >
                          <i class="fas fa-times"></i> Limpiar Filtros
                        </button>
                      </div>
                    </div>
                  </div>

                  <!-- Resumen -->
                  <div class="row mb-4" id="resumenEstadoCuenta" style="display: none">
                    <div class="col-md-3">
                      <div class="card text-center bg-light">
                        <div class="card-body">
                          <h6 class="card-subtitle mb-2 text-muted">Saldo Inicial</h6>
                          <h4 class="card-title" id="resumenSaldoInicial">$0.00</h4>
                        </div>
                      </div>
                    </div>
                    <div class="col-md-3">
                      <div class="card text-center bg-success bg-opacity-10">
                        <div class="card-body">
                          <h6 class="card-subtitle mb-2 text-muted">Total Entradas</h6>
                          <h4 class="card-title text-success" id="resumenEntradas">$0.00</h4>
                        </div>
                      </div>
                    </div>
                    <div class="col-md-3">
                      <div class="card text-center bg-danger bg-opacity-10">
                        <div class="card-body">
                          <h6 class="card-subtitle mb-2 text-muted">Total Salidas</h6>
                          <h4 class="card-title text-danger" id="resumenSalidas">$0.00</h4>
                        </div>
                      </div>
                    </div>
                    <div class="col-md-3">
                      <div class="card text-center bg-primary bg-opacity-10">
                        <div class="card-body">
                          <h6 class="card-subtitle mb-2 text-muted">Saldo Final</h6>
                          <h4 class="card-title text-primary" id="resumenSaldoFinal">$0.00</h4>
                        </div>
                      </div>
                    </div>
                  </div>

                  <!-- Tabla de Movimientos -->
                  <div class="table-responsive">
                    <table class="table table-striped table-hover" id="tablaEstadoCuenta">
                      <thead class="table-dark">
                        <tr>
                          <th>Fecha</th>
                          <th>Concepto</th>
                          <th>Referencia</th>
                          <th class="text-end">Entrada</th>
                          <th class="text-end">Salida</th>
                          <th class="text-end">Saldo Acumulado</th>
                        </tr>
                      </thead>
                      <tbody id="tbodyEstadoCuenta">
                        <tr>
                          <td colspan="6" class="text-center text-muted">
                            <i class="fas fa-info-circle"></i> Seleccione una cuenta bancaria y
                            fechas para consultar el estado de cuenta
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>

            <!-- Tab Movimientos -->
            <div class="tab-pane fade show active" id="movimientos" role="tabpanel">
              <div class="card mb-4">
                <div class="card-header" style="background-color: #2e4154; color: #ffffff">
                  <h4 class="card-title mb-0" style="color: #ffffff">
                    <i class="fas fa-exchange-alt" style="color: #ffffff"></i> Registrar Movimiento
                  </h4>
                </div>
                <div class="card-body">
                  <form class="needs-validation" novalidate>
                    <!-- Informacion del deposito o Retiro -->
                    <div class="form-section">
                      <h4 class="section-title">
                        <i class="fas fa-hashtag"></i>
                        Información General
                      </h4>
                      <div class="row g-3">
                        <div class="col-md-6">
                          <label for="ingresoegreso" class="form-label">Ingreso o Egreso </label>
                          <select
                            id="ingresoegreso"
                            class="form-select"
                            required
                            data-action="actualizarEtiquetasBancarias"
                          >
                            <option value="">Seleccione...</option>
                            <option value="ingreso">Ingreso</option>
                            <option value="egreso">Egreso</option>
                          </select>
                          <div class="invalid-feedback">
                            Por favor seleccione si es un ingreso o un egreso
                          </div>
                        </div>

                        <div class="col-md-6">
                          <p>
                            <b>Ingreso: </b>Seleciona si entro dinero a alguna de las cuentas, sea
                            cual sea el motivo.
                          </p>
                          <p>
                            <b>Egreso: </b>Seleciona si salio o se realizo algun pago a algun
                            proveedor. Incluye; Nomina, Proveedor, Prestamo, Devoluciones, etc.
                          </p>
                        </div>
                      </div>
                    </div>

                    <!-- Datos del Proveedor o Cliente -->
                    <div class="form-section">
                      <div class="row g-3">
                        <div class="col-md-6">
                          <label for="Proveedor" class="form-label">Cliente o Proveedor </label>
                          <input
                            type="text"
                            class="form-control"
                            id="Proveedor"
                            placeholder="Nombre del Proveedor"
                            required
                          />
                          <div class="invalid-feedback">
                            Por favor ingrese el nombre del proveedor
                          </div>
                        </div>
                        <div class="col-md-6">
                          <label for="origen" class="form-label">Origen </label>
                          <select id="origen" class="form-select" required>
                            <option value="">Seleccione...</option>
                            <option value="nacional">Nacional</option>
                            <option value="extranjero">Extranjero</option>
                          </select>
                          <div class="invalid-feedback">Por favor seleccione el tipo de origen</div>
                        </div>
                        <div class="col-md-6">
                          <label for="tipodocumento" class="form-label">Tipo de Documento </label>
                          <select id="tipodocumento" class="form-select" required>
                            <option value="">Seleccione...</option>
                            <option value="factura">Factura</option>
                            <option value="ticket">Ticket</option>
                            <option value="nota">Nota</option>
                            <option value="sincomprobante">Sin Comprobante</option>
                          </select>
                          <div class="invalid-feedback">
                            Por favor seleccione el tipo de documento
                          </div>
                        </div>
                        <div class="col-md-6">
                          <label for="numeroFactura" class="form-label">Número Factura </label>
                          <input
                            type="text"
                            class="form-control"
                            id="numeroFactura"
                            placeholder="Ej: F-123456"
                            pattern="[A-Za-z0-9\-]+"
                            title="Solo letras, números y guiones"
                          />
                          <div class="invalid-feedback">
                            Solo se permiten letras, números y guiones
                          </div>
                        </div>
                        <div class="col-md-6">
                          <label for="fechapago" class="form-label">Fecha de Pago </label>
                          <input
                            type="date"
                            class="form-control"
                            id="fechapago"
                            placeholder="Fecha de Pago"
                            required
                          />
                          <div class="invalid-feedback">Por favor ingrese la fecha de pago</div>
                        </div>
                        <div class="col-md-6">
                          <label for="montoapagar" class="form-label">Monto a Pagar </label>
                          <input
                            type="text"
                            class="form-control"
                            id="montoapagar"
                            placeholder="Monto a Pagar"
                            required
                            pattern="[0-9,]+\.?[0-9]*"
                            inputmode="decimal"
                          />
                          <div class="invalid-feedback">Por favor ingrese el monto a pagar</div>
                        </div>
                        <div class="col-md-6">
                          <label for="tipomoneda" class="form-label">Moneda </label>
                          <select
                            id="tipomoneda"
                            class="form-select"
                            required
                            data-action="toggleTipoCambioTesorería"
                          >
                            <option value="">Seleccione...</option>
                            <option value="mxn">MXN</option>
                            <option value="dls">DLS</option>
                          </select>
                          <div class="invalid-feedback">Por favor seleccione el tipo de Moneda</div>
                        </div>
                        <div class="col-md-6" id="grupoTipoCambioTesorería" style="display: none">
                          <label for="tipoCambioTesorería" class="form-label"
                            >Tipo de cambio (USD a MXN) *</label
                          >
                          <input
                            type="number"
                            class="form-control"
                            id="tipoCambioTesorería"
                            placeholder="Ej: 17.5633"
                            step="0.0001"
                            min="0"
                            data-decimales="4"
                          />
                          <div class="invalid-feedback">
                            Por favor ingrese el tipo de cambio con 4 decimales (ej: 17.5633)
                          </div>
                          <small class="form-text text-muted"
                            >Debe tener exactamente 4 decimales (ej: 17.5633)</small
                          >
                        </div>
                        <div class="col-md-6">
                          <label for="servicioproducto" class="form-label"
                            >Servicio o Producto
                          </label>
                          <select id="servicioproducto" class="form-select" required>
                            <option value="">Seleccione...</option>
                            <option value="servicio">Servicio</option>
                            <option value="producto">Producto</option>
                          </select>
                          <div class="invalid-feedback">
                            Por favor seleccione si es servicio o producto
                          </div>
                        </div>
                      </div>
                    </div>
                    <!-- Datos Bancarios -->
                    <div class="form-section">
                      <h4 class="section-title">
                        <i class="fa-solid fa-cash-register"></i>
                        Datos Bancarios
                      </h4>
                      <div class="row g-3">
                        <div class="col-md-6">
                          <label for="metodopago" class="form-label">Método de Pago </label>
                          <select id="metodopago" class="form-select" required>
                            <option value="">Seleccione...</option>
                            <option value="transferencia">Transferencia</option>
                            <option value="cheque">Cheque</option>
                            <option value="efectivo">Efectivo</option>
                            <option value="tarjetacredito">Tarjeta de Crédito</option>
                            <option value="tarjetadebito">Tarjeta de Débito</option>
                            <option value="otro">Otro</option>
                          </select>
                          <div class="invalid-feedback">Por favor seleccione el método de pago</div>
                        </div>
                      </div>

                      <!-- Ayuda visual según tipo de movimiento -->
                      <div id="ayudaBancaria" class="alert alert-info mb-3" style="display: none">
                        <i class="fas fa-info-circle"></i> <span id="textoAyudaBancaria"></span>
                      </div>

                      <div class="row g-3">
                        <div class="col-md-6">
                          <label for="bancoorigen" class="form-label" id="labelBancoOrigen">
                            <i class="fas fa-university"></i> Banco Origen
                          </label>
                          <select
                            class="form-select"
                            id="bancoorigen"
                            required
                            data-action="actualizarCuentasOrigen"
                          >
                            <option value="">Seleccione un banco...</option>
                          </select>
                          <small class="form-text text-muted" id="ayudaBancoOrigen"></small>
                          <div class="invalid-feedback">
                            Por favor seleccione el banco de origen
                          </div>
                        </div>
                        <div class="col-md-6">
                          <label for="cuentaorigen" class="form-label" id="labelCuentaOrigen">
                            <i class="fas fa-credit-card"></i> Cuenta Origen
                          </label>
                          <select class="form-select" id="cuentaorigen" required>
                            <option value="">Primero seleccione un banco</option>
                          </select>
                          <small class="form-text text-muted" id="ayudaCuentaOrigen"></small>
                          <div class="invalid-feedback">
                            Por favor seleccione la cuenta de origen
                          </div>
                        </div>
                      </div>

                      <div class="row g-3">
                        <div class="col-md-6">
                          <label for="bancodestino" class="form-label" id="labelBancoDestino">
                            <i class="fas fa-university"></i> Banco Destino
                          </label>
                          <input
                            type="text"
                            class="form-control"
                            id="bancodestino"
                            placeholder="Banco Destino"
                            required
                          />
                          <small class="form-text text-muted" id="ayudaBancoDestino"></small>
                          <div class="invalid-feedback">Por favor ingrese el banco de destino</div>
                        </div>
                        <div class="col-md-6">
                          <label for="cuentadestino" class="form-label" id="labelCuentaDestino">
                            <i class="fas fa-credit-card"></i> Cuenta Destino
                          </label>
                          <input
                            type="text"
                            class="form-control"
                            id="cuentadestino"
                            placeholder="Cuenta de Destino"
                            required
                          />
                          <small class="form-text text-muted" id="ayudaCuentaDestino"></small>
                          <div class="invalid-feedback">Por favor ingrese la cuenta de destino</div>
                        </div>
                      </div>

                      <div class="row g-3">
                        <div class="col-md-6">
                          <label for="referenciabancaria" class="form-label"
                            >Referencia Bancaria
                          </label>
                          <input
                            type="text"
                            class="form-control"
                            id="referenciabancaria"
                            placeholder="Referencia Bancaria"
                            required
                          />
                          <div class="invalid-feedback">
                            Por favor ingrese la referencia Bancaria
                          </div>
                        </div>

                        <div class="col-md-4">
                          <label for="Evidencia" class="form-label">Evidencia</label>
                          <form method="post" action="/send/" enctype="multipart/form-data">
                            <input type="file" />
                          </form>
                        </div>
                      </div>
                    </div>
                    <!-- Observaciones -->
                    <div class="form-section">
                      <h4 class="section-title">
                        <i class="fa-solid fa-clipboard"></i>
                        Observaciones
                      </h4>
                      <div class="row g-3">
                        <div class="col-12">
                          <div class="form-check form-check-inline">
                            <input
                              class="form-check-input"
                              type="radio"
                              name="observaciones"
                              id="observacionesSi"
                              value="si"
                            />
                            <label class="form-check-label" for="observacionesSi">Sí</label>
                          </div>
                          <div class="form-check form-check-inline">
                            <input
                              class="form-check-input"
                              type="radio"
                              name="observaciones"
                              id="observacionesNo"
                              value="no"
                              checked
                            />
                            <label class="form-check-label" for="observacionesNo">No</label>
                          </div>
                        </div>
                        <div class="col-12" id="descripcionObservaciones" style="display: none">
                          <label for="descripcion" class="form-label"
                            >Describe tus Observaciones</label
                          >
                          <textarea
                            class="form-control"
                            id="descripcion"
                            rows="3"
                            placeholder="Describe tus Observaciones"
                          ></textarea>
                        </div>
                      </div>
                    </div>

                    <!-- Botones de Acción -->
                    <div class="form-actions">
                      <button
                        type="button"
                        class="btn btn-outline-warning me-2"
                        data-action="clearCurrentForm"
                      >
                        <i class="fas fa-times"></i> Limpiar
                      </button>
                      <button
                        type="button"
                        class="btn btn-primary me-2"
                        data-action="guardarMovimiento"
                      >
                        <i class="fas fa-check"></i> Registrar Movimiento
                      </button>
                    </div>
                  </form>
                </div>
              </div>

              <!-- Historial de Movimientos Tesorería -->
              <div class="card mt-4">
                <div
                  class="card-header historial-header d-flex justify-content-between align-items-center"
                >
                  <h5 class="mb-0">
                    <i class="fas fa-exchange-alt"></i>
                    Historial de Movimientos Tesorería
                  </h5>
                  <button
                    type="button"
                    class="btn btn-outline-light btn-sm exportar-btn-header"
                    data-action="exportarTesoreriaExcel"
                  >
                    <i class="fas fa-file-excel"></i> Exportar
                  </button>
                </div>
                <div class="card-body">
                  <!-- Filtros -->
                  <div class="filter-section mb-3">
                    <h6 class="mb-3"><i class="fas fa-filter"></i> Filtros de Búsqueda</h6>
                    <div class="row g-2">
                      <div class="col-md-3">
                        <label class="form-label">Cliente/Proveedor</label>
                        <input
                          type="text"
                          id="filtroClienteProveedor"
                          class="form-control"
                          placeholder="Buscar cliente o proveedor..."
                          data-action="aplicarFiltrosMovimientos"
                        />
                      </div>
                      <div class="col-md-3">
                        <label class="form-label">Factura/Notas/Tickets</label>
                        <input
                          type="text"
                          id="filtroFacturaNotasTickets"
                          class="form-control"
                          placeholder="Buscar por factura, notas o tickets..."
                          data-action="aplicarFiltrosMovimientos"
                        />
                      </div>
                      <div class="col-md-3">
                        <label class="form-label">Banco Origen</label>
                        <select
                          class="form-select"
                          id="filtroBancoOrigen"
                          data-action="actualizarCuentasOrigenFiltro"
                        >
                          <option value="">Todos los bancos</option>
                        </select>
                      </div>
                      <div class="col-md-3">
                        <label class="form-label">Cuenta Origen</label>
                        <select
                          class="form-select"
                          id="filtroCuentaOrigen"
                          data-action="aplicarFiltrosMovimientos"
                        >
                          <option value="">Todas las cuentas</option>
                        </select>
                      </div>
                      <div class="col-md-3">
                        <label class="form-label">Banco Destino</label>
                        <input
                          type="text"
                          id="filtroBancoDestino"
                          class="form-control"
                          placeholder="Buscar banco destino..."
                          data-action="aplicarFiltrosMovimientos"
                        />
                      </div>
                      <div class="col-md-3">
                        <label class="form-label">Cuenta Destino</label>
                        <input
                          type="text"
                          id="filtroCuentaDestino"
                          class="form-control"
                          placeholder="Buscar cuenta destino..."
                          data-action="aplicarFiltrosMovimientos"
                        />
                      </div>
                      <div class="col-md-3">
                        <label class="form-label">Fecha Desde</label>
                        <input
                          type="date"
                          id="filtroFechaDesde"
                          class="form-control"
                          data-action="aplicarFiltrosMovimientos"
                        />
                      </div>
                      <div class="col-md-3">
                        <label class="form-label">Fecha Hasta</label>
                        <input
                          type="date"
                          id="filtroFechaHasta"
                          class="form-control"
                          data-action="aplicarFiltrosMovimientos"
                        />
                      </div>
                      <div class="col-md-3 d-flex align-items-end justify-content-end ms-auto">
                        <button
                          class="btn btn-outline-secondary btn-sm"
                          data-action="limpiarFiltrosTesoreria"
                          type="button"
                          title="Borrar filtros"
                        >
                          <i class="fas fa-times"></i> Limpiar Filtros
                        </button>
                      </div>
                    </div>
                  </div>
                  <div class="table-responsive">
                    <table class="table table-hover">
                      <thead>
                        <tr>
                          <th>ID</th>
                          <th>Fecha</th>
                          <th>Tipo</th>
                          <th>Descripción</th>
                          <th>Cliente/Proveedor</th>
                          <th>Monto</th>
                          <th>Método Pago</th>
                          <th>Número Factura</th>
                          <th>Referencia</th>
                          <th>Acciones</th>
                        </tr>
                      </thead>
                      <tbody id="tablaHistorialTesorería">
                        <tr>
                          <td colspan="10" class="text-center text-muted">
                            No hay movimientos registrados
                          </td>
                        </tr>
                      </tbody>
                    </table>
                    <!-- Contenedor de paginación -->
                    <div id="paginacionTesoreria" class="mt-3"></div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Tab Solicitudes -->
            <div class="tab-pane fade" id="solicitudes" role="tabpanel">
              <div class="card mt-3">
                <div
                  class="card-header d-flex justify-content-between align-items-center"
                  style="background-color: #2e4154; color: #ffffff"
                >
                  <h5 class="mb-0" style="color: #ffffff !important">
                    <i class="fas fa-list" style="color: #ffffff !important"></i> Solicitudes de
                    Pago
                  </h5>
                  <button
                    type="button"
                    class="btn btn-outline-light btn-sm exportar-btn-header"
                    data-action="exportarSolicitudesTesoreriaExcel"
                    title="Exportar a Excel"
                  >
                    <i class="fas fa-file-excel"></i> Exportar
                  </button>
                </div>
                <div class="card-body">
                  <div class="filter-section mb-3">
                    <div class="row g-2">
                      <div class="col-md-3">
                        <label class="form-label">Proveedor</label>
                        <input
                          type="text"
                          id="tesoFiltroProveedor"
                          class="form-control"
                          placeholder="Buscar proveedor..."
                          data-action="aplicarFiltrosTesoreria"
                        />
                      </div>
                      <div class="col-md-2">
                        <label class="form-label">Estado</label>
                        <input
                          type="text"
                          id="tesoFiltroEstado"
                          class="form-control"
                          placeholder="Buscar estado..."
                          data-action="aplicarFiltrosTesoreria"
                        />
                      </div>
                      <div class="col-md-2">
                        <label class="form-label">Fecha desde</label>
                        <input
                          type="date"
                          id="tesoFiltroDesde"
                          class="form-control"
                          data-action="aplicarFiltrosTesoreria"
                        />
                      </div>
                      <div class="col-md-2">
                        <label class="form-label">Fecha hasta</label>
                        <input
                          type="date"
                          id="tesoFiltroHasta"
                          class="form-control"
                          data-action="aplicarFiltrosTesoreria"
                        />
                      </div>
                      <div class="col-md-2">
                        <label class="form-label">Prioridad</label>
                        <select
                          id="tesoFiltroPrioridad"
                          class="form-select"
                          data-action="aplicarFiltrosTesoreria"
                        >
                          <option value="">Todas</option>
                          <option value="normal">Normal</option>
                          <option value="alta">Alta</option>
                          <option value="urgente">Urgente</option>
                        </select>
                      </div>
                      <div class="col-md-1 d-flex align-items-end">
                        <button
                          class="btn btn-outline-secondary btn-sm w-100"
                          data-action="limpiarFiltrosSolicitudesTesoreria"
                          type="button"
                        >
                          <i class="fas fa-times"></i>
                          Limpiar Filtros
                        </button>
                      </div>
                    </div>
                  </div>

                  <div class="table-responsive">
                    <table class="table table-hover">
                      <thead>
                        <tr>
                          <th>OP</th>
                          <th>Proveedor</th>
                          <th>Monto</th>
                          <th>Fecha Requerida</th>
                          <th>Prioridad</th>
                          <th>Estado</th>
                          <th>Acciones</th>
                        </tr>
                      </thead>
                      <tbody id="tbodyOrdenesPago"></tbody>
                    </table>
                    <!-- Contenedor de paginación -->
                    <div id="paginacionSolicitudesTesoreria" class="mt-3"></div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal para Registrar Pago de Solicitud -->
    <div
      class="modal fade"
      id="modalRegistrarPagoSolicitud"
      tabindex="-1"
      aria-labelledby="modalRegistrarPagoSolicitudLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="modalRegistrarPagoSolicitudLabel">
              <i class="fas fa-credit-card"></i> Registrar Pago de Solicitud
            </h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            <form id="formRegistrarPagoSolicitud" class="needs-validation" novalidate>
              <!-- Información de la Solicitud -->
              <div class="row mb-3">
                <div class="col-12">
                  <h6 class="text-primary">
                    <i class="fas fa-info-circle"></i> Información de la Solicitud
                  </h6>
                  <div class="card bg-light">
                    <div class="card-body">
                      <div class="row">
                        <div class="col-md-6">
                          <strong>Proveedor:</strong> <span id="infoProveedor"></span>
                        </div>
                        <div class="col-md-6">
                          <strong>Monto:</strong> <span id="infoMonto"></span>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Información del Pago -->
              <div class="row mb-3">
                <div class="col-12">
                  <h6 class="text-success">
                    <i class="fas fa-credit-card"></i> Información del Pago
                  </h6>
                </div>
              </div>

              <div class="row g-3">
                <div class="col-md-6">
                  <label for="fechaPagoSolicitud" class="form-label">Fecha de Pago *</label>
                  <input type="date" class="form-control" id="fechaPagoSolicitud" required />
                  <div class="invalid-feedback">Por favor ingrese la fecha de pago</div>
                </div>
                <div class="col-md-6">
                  <label for="montoPagoSolicitud" class="form-label">Monto Pagado *</label>
                  <input
                    type="text"
                    class="form-control"
                    id="montoPagoSolicitud"
                    required
                    readonly
                  />
                  <div class="invalid-feedback">Por favor ingrese el monto pagado</div>
                  <small class="form-text text-muted"
                    >El monto está preestablecido según la solicitud autorizada</small
                  >
                </div>
                <div class="col-md-6">
                  <label for="metodoPagoSolicitud" class="form-label">Método de Pago *</label>
                  <select class="form-select" id="metodoPagoSolicitud" required>
                    <option value="">Seleccione...</option>
                    <option value="transferencia">Transferencia</option>
                    <option value="cheque">Cheque</option>
                    <option value="efectivo">Efectivo</option>
                    <option value="tarjetacredito">Tarjeta de Crédito</option>
                    <option value="tarjetadebito">Tarjeta de Débito</option>
                    <option value="otro">Otro</option>
                  </select>
                  <div class="invalid-feedback">Por favor seleccione el método de pago</div>
                </div>
                <div class="col-md-6">
                  <label for="bancoOrigenSolicitud" class="form-label">Banco de Origen *</label>
                  <select
                    class="form-select"
                    id="bancoOrigenSolicitud"
                    required
                    data-action="actualizarCuentasOrigenSolicitud"
                  >
                    <option value="">Seleccione un banco...</option>
                  </select>
                  <div class="invalid-feedback">Por favor seleccione el banco de origen</div>
                </div>
                <div class="col-md-6">
                  <label for="cuentaOrigenSolicitud" class="form-label">Cuenta de Origen *</label>
                  <select class="form-select" id="cuentaOrigenSolicitud" required>
                    <option value="">Primero seleccione un banco</option>
                  </select>
                  <div class="invalid-feedback">Por favor seleccione la cuenta de origen</div>
                </div>
                <div class="col-md-6">
                  <label for="bancoDestinoSolicitud" class="form-label">Banco de Destino *</label>
                  <input
                    type="text"
                    class="form-control"
                    id="bancoDestinoSolicitud"
                    placeholder="Ej: BBVA, Santander, etc."
                    required
                  />
                  <div class="invalid-feedback">Por favor ingrese el banco de destino</div>
                </div>
                <div class="col-md-6">
                  <label for="cuentaDestinoSolicitud" class="form-label">Cuenta de Destino *</label>
                  <input
                    type="text"
                    class="form-control"
                    id="cuentaDestinoSolicitud"
                    placeholder="Número de cuenta"
                    required
                  />
                  <div class="invalid-feedback">Por favor ingrese la cuenta de destino</div>
                </div>
                <div class="col-md-6">
                  <label for="referenciaPagoSolicitud" class="form-label"
                    >Referencia del Pago *</label
                  >
                  <input
                    type="text"
                    class="form-control"
                    id="referenciaPagoSolicitud"
                    placeholder="Ej: REF123456789"
                    required
                  />
                  <div class="invalid-feedback">Por favor ingrese la referencia del pago</div>
                </div>
                <div class="col-12">
                  <label for="observacionesPagoSolicitud" class="form-label">Observaciones</label>
                  <textarea
                    class="form-control"
                    id="observacionesPagoSolicitud"
                    rows="3"
                    placeholder="Observaciones adicionales sobre el pago..."
                  ></textarea>
                </div>
              </div>

              <!-- Comprobantes -->
              <div class="row mb-3 mt-4">
                <div class="col-12">
                  <h6 class="text-info"><i class="fas fa-paperclip"></i> Comprobantes de Pago</h6>
                  <div class="card">
                    <div class="card-body">
                      <div class="mb-3">
                        <label for="comprobantesPagoSolicitud" class="form-label"
                          >Subir Comprobantes *</label
                        >
                        <input
                          type="file"
                          class="form-control"
                          id="comprobantesPagoSolicitud"
                          multiple
                          accept=".pdf,.jpg,.jpeg,.png,.doc,.docx"
                          required
                          data-action="previewComprobantesSolicitud"
                        />
                        <div class="form-text">
                          Formatos permitidos: PDF, JPG, PNG, DOC, DOCX. Máximo 10MB por archivo.
                        </div>
                        <div class="invalid-feedback">
                          Por favor suba al menos un comprobante de pago
                        </div>
                      </div>
                      <div id="previewComprobantesSolicitud" class="mt-3"></div>
                    </div>
                  </div>
                </div>
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
              Cancelar
            </button>
            <button type="button" class="btn btn-success" data-action="registrarPagoSolicitud">
              <i class="fas fa-check"></i> Registrar Pago
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- ===== SCRIPTS COMUNES Y MÓDULOS (Carga automática) ===== -->
    <script src="../assets/scripts/performance/common-head-loader.js"></script>
    <script src="../assets/scripts/performance/common-scripts-loader.js"></script>
    <script src="../assets/scripts/performance/page-modules-config.js"></script>
    <script src="../assets/scripts/performance/page-modules-loader.js"></script>
    <script src="../assets/scripts/paginacion.js" defer></script>
    <!-- tesoreria.js, tesoreria-movimientos.js y tesoreria-estado-cuenta.js se cargan automáticamente por page-modules-loader.js -->

    <!-- Modal para Ver Detalles de Movimiento -->
    <div
      class="modal fade"
      id="modalDetallesMovimiento"
      tabindex="-1"
      aria-labelledby="modalDetallesMovimientoLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="modalDetallesMovimientoLabel">
              <i class="fas fa-info-circle"></i>
              Detalles del Movimiento
            </h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            <div id="detallesMovimientoContent">
              <!-- Los detalles se cargarán dinámicamente -->
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal para Ver Detalles de Solicitud/Orden de Pago -->
    <div
      class="modal fade"
      id="modalDetallesSolicitud"
      tabindex="-1"
      aria-labelledby="modalDetallesSolicitudLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header bg-info text-white">
            <h5 class="modal-title" id="modalDetallesSolicitudLabel">
              <i class="fas fa-eye"></i> Detalles de la Orden de Pago
            </h5>
            <button
              type="button"
              class="btn-close btn-close-white"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body" id="modalDetallesSolicitudBody">
            <!-- El contenido se cargará dinámicamente -->
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
              <i class="fas fa-times"></i> Cerrar
            </button>
          </div>
        </div>
      </div>
    </div>

    <script src="../assets/scripts/menu/sidebar-handler.js"></script>
    <!-- Script para indicador de carga del backend (compartido) -->
    <script src="../assets/scripts/backend-ready-indicator.js"></script>
  </body>
</html>
